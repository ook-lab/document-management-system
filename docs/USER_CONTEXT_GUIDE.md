# ユーザーコンテキスト設定ガイド

## 概要

`config/user_context.yaml` ファイルを使用することで、検索時にユーザー固有の前提情報を活用できます。
このファイルには、お子さんの情報（名前、生年月日、学校・塾のスケジュールなど）を記録できます。

## ファイルの場所

```
document_management_system/
└── config/
    └── user_context.yaml
```

## 設定ファイルの編集方法

### 1. ファイルを開く

テキストエディタで `config/user_context.yaml` を開きます。

### 2. 子供の情報を編集

ファイル内の `children` セクションで、お子さんの情報を編集します：

```yaml
children:
  - name: "太郎"  # お子さんの名前に変更
    aliases: ["たろう", "タロウ", "たろちゃん", "太郎君"]  # 別名・愛称（省略可）
    birth_date: "2015-04-01"  # 生年月日を変更
    grade: 5  # 学年を変更

    school:
      name: "○○小学校"  # 学校名を変更
      class: "5年1組"  # クラスを変更

      schedule:
        monday:
          - time: "08:30-09:15"
            subject: "国語"
          # ...他の授業を追加
```

#### 別名（aliases）の設定

お子さんの呼び方にバリエーションがある場合、`aliases` フィールドに登録できます：

```yaml
children:
  - name: "太郎"
    aliases: ["たろう", "タロウ", "たろちゃん", "太郎君", "Taro"]
```

**使用例**：
- 「たろちゃんの宿題は？」→ 太郎さんの情報を参照
- 「タロウの塾の時間は？」→ 太郎さんの情報を参照
- 「太郎君の時間割を見せて」→ 太郎さんの情報を参照

**注意点**：
- `aliases` は省略可能です（不要な場合は削除してOK）
- リスト形式で複数の別名を登録できます
- ひらがな、カタカナ、漢字、ローマ字など、どんな形式でもOK

### 3. 学校の時間割を設定

各曜日（monday, tuesday, wednesday, thursday, friday）に、授業の時間と科目を設定します：

```yaml
schedule:
  monday:
    - time: "08:30-09:15"
      subject: "国語"
    - time: "09:25-10:10"
      subject: "算数"
    # 必要な授業を追加
```

### 4. 塾の情報を設定

塾に通っている場合は、塾の名前とスケジュールを設定します：

```yaml
cram_school:
  name: "○○塾"  # 塾の名前
  schedule:
    monday:
      - time: "17:00-19:00"
        subject: "算数"
    wednesday:
      - time: "17:00-19:00"
        subject: "国語"
```

### 5. 複数の子供を登録する

複数のお子さんがいる場合は、`children` リストに追加します：

```yaml
children:
  - name: "太郎"
    birth_date: "2015-04-01"
    grade: 5
    # ...太郎さんの情報

  - name: "花子"
    birth_date: "2017-08-15"
    grade: 3
    # ...花子さんの情報
```

## 検索での活用方法

この設定ファイルに記録された情報は、検索時に自動的に活用されます。

### 例1: 時間割に関する質問

**質問**: 「明日の月曜日の3時間目は何の授業？」

**回答**: 設定されたスケジュールから、該当する授業を自動的に抽出して回答します。

### 例2: 子供の名前を含む質問

**質問**: 「太郎の塾の時間は？」

**回答**: user_context.yamlに登録された太郎さんの塾スケジュールを参照して回答します。

### 例3: クラス情報を含む質問

**質問**: 「5年1組の学年通信を見せて」

**回答**: クラス情報を考慮して、関連する文書を検索します。

## 設定のテンプレート

### 最小限の設定

```yaml
children:
  - name: "太郎"
    aliases: ["たろう"]  # 省略可能
    birth_date: "2015-04-01"
    grade: 5
    school:
      name: "○○小学校"
      class: "5年1組"
      schedule: {}
    cram_school:
      name: ""
      schedule: {}
```

### 詳細な設定

完全な設定例は `config/user_context.yaml` ファイルを参照してください。

## 注意事項

1. **YAML形式**: インデント（スペース2つ）を正確に保ってください。タブは使用しないでください。

2. **日本語対応**: ファイルはUTF-8エンコーディングで保存してください。

3. **必須項目**: 各子供に最低限 `name`, `birth_date`, `grade` を設定してください。

4. **更新の反映**: ファイルを編集した後、アプリケーションを再起動する必要はありません。次の検索時に自動的に読み込まれます。

5. **Git管理**: このファイルはGitで管理されます。機密情報は入れないでください。

## トラブルシューティング

### YAMLの構文エラー

ファイルを編集後、以下のコマンドでYAMLの構文をチェックできます：

```bash
python -c "import yaml; yaml.safe_load(open('config/user_context.yaml'))"
```

エラーが表示されない場合は、正しく設定されています。

### 設定が反映されない

1. ファイルのパスが正しいか確認してください（`config/user_context.yaml`）
2. YAMLの構文が正しいか確認してください
3. アプリケーションのログを確認してください

## サポート

質問や問題がある場合は、プロジェクトのIssueページで報告してください。
