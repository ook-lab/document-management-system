"""
G_unified_pipeline prompts module
"""

# Stage G: レシート構造化プロンプト（家計簿用）
STAGE_G_FORMATTING_PROMPT = """あなたはレシートのOCR結果から構造化データを生成する専門家です。

以下は Stage F（OCR）で抽出されたレシート全文です：

---
{vision_raw}
---

このテキストから、レシート情報を構造化してJSON形式で出力してください。

## 構造化タスク

### 1. 店舗情報の抽出
- 店舗名
- 住所
- 電話番号
- 店舗コード（記載されていれば）

### 2. 取引情報の抽出
- 日付（YYYY-MM-DD形式）
- 時刻（HH:MM:SS形式、記載されていれば）
- レジ番号
- レシート番号
- 取引番号

### 3. 商品明細の抽出
各商品について：
- 行番号（レシート記載の順序）
- 商品名（レシート記載のまま）
- 数量
- 単価
- 金額
- 税率マーク（※、★など）

### 4. 金額情報の抽出
**重要：レシートに記載されている数値をそのまま抽出（計算・推測禁止）**

- 小計（税抜小計、記載されていれば）
- 8%対象額（税抜）
- 8%消費税額
- 10%対象額（税抜）
- 10%消費税額
- 消費税合計
- 合計（支払額）
- お預かり（記載されていれば）
- お釣り（記載されていれば）

### 5. 支払情報
- 支払方法（現金/カード/電子マネー等）
- カード情報（記載されていれば）

### 6. その他情報
- ポイント情報
- キャンペーン情報
- バーコード番号
- その他の特記事項

## 出力形式

以下のJSON形式で出力してください：

```json
{{
  "shop_info": {{
    "name": "店舗名",
    "address": "住所（記載があれば）",
    "phone": "電話番号（記載があれば）",
    "store_code": "店舗コード（記載があれば）"
  }},
  "transaction_info": {{
    "date": "YYYY-MM-DD",
    "time": "HH:MM:SS（記載があれば）",
    "register_number": "レジ番号（記載があれば）",
    "receipt_number": "レシート番号（記載があれば）",
    "transaction_number": "取引番号（記載があれば）"
  }},
  "items": [
    {{
      "line_number": 1,
      "line_text": "レシートのこの行のテキストそのまま",
      "product_name": "商品名",
      "quantity": 1,
      "unit_price": 100,
      "amount": 100,
      "tax_mark": "※または★またはなし"
    }}
  ],
  "amounts": {{
    "subtotal": 1377,
    "tax_8_base": 0,
    "tax_8_amount": 0,
    "tax_10_base": 1377,
    "tax_10_amount": 123,
    "total_tax": 123,
    "total": 1500,
    "received": 2000,
    "change": 500
  }},
  "payment": {{
    "method": "現金",
    "card_info": null
  }},
  "other_info": {{
    "points": "ポイント情報",
    "campaign": "キャンペーン情報",
    "barcode": "バーコード番号",
    "notes": "その他特記事項"
  }}
}}
```

## 重要な注意事項

1. **数値は必ずレシート記載のまま**
   - 計算しない、推測しない
   - 記載がない項目は null にする

2. **8%/10%税率の区分**
   - レシートに税率の記載（※、★、8%、10%マーク）があればそれを使う
   - 記載がない場合は null にする（推測しない）

3. **小計・消費税・合計の関係**
   - レシートに「小計」「消費税」「合計」が明記されている場合、その数値をそのまま使う
   - 外税レシート：小計 + 消費税 = 合計
   - 内税レシート：合計のみ（小計は記載なしの場合あり）

4. **税額サマリー**
   - 「8%対象 ○○円（税 △△円）」のような記載があれば必ず抽出
   - 「10%対象 ○○円（税 △△円）」のような記載があれば必ず抽出

5. **記載がない項目**
   - 記載がない項目は null にする
   - 空文字列や0ではなく null を使う

## エラー処理

- OCR結果が不完全な場合：`{{"error": "incomplete_ocr", "details": "不完全な箇所の説明"}}`
- レシートとして認識できない場合：`{{"error": "not_a_receipt"}}`
"""
