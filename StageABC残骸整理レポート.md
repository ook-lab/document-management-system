# Stage A/B/C æ®‹éª¸æ•´ç†ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿæ–½æ—¥**: 2025-12-19
**å¯¾è±¡**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®Stage A/B/Cé–¢é€£ã®æ®‹éª¸

---

## ğŸ“Š æ•´ç†ã‚µãƒãƒªãƒ¼

ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ **Stage E-K** ã«ç§»è¡Œæ¸ˆã¿ã§ã™ãŒã€æ—§ã‚·ã‚¹ãƒ†ãƒ ï¼ˆStage A/B/Cï¼‰ã®æ®‹éª¸ãŒåºƒç¯„å›²ã«æ®‹ã£ã¦ã„ã¾ã—ãŸã€‚
ã“ã‚Œã‚‰ã‚’å¾¹åº•çš„ã«æ¤œç´¢ãƒ»æ•´ç†ã—ã€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’æœ€æ–°ã®å‘½åè¦å‰‡ã«çµ±ä¸€ã—ã¾ã—ãŸã€‚

---

## âœ… å®Ÿæ–½ã—ãŸæ•´ç†ä½œæ¥­

### 1. ãƒ•ã‚¡ã‚¤ãƒ«åã®å¤‰æ›´ (2ãƒ•ã‚¡ã‚¤ãƒ«)

| æ—§ãƒ•ã‚¡ã‚¤ãƒ«å | æ–°ãƒ•ã‚¡ã‚¤ãƒ«å | ç†ç”± |
|------------|------------|------|
| `H_streamlit/utils/stageC_reprocessor.py` | `H_streamlit/utils/stage_h_reprocessor.py` | å®Ÿéš›ã«ã¯Stage H-Kã‚’å®Ÿè¡Œ |
| `ui/utils/stageC_reprocessor.py` | `ui/utils/stage_h_reprocessor.py` | å®Ÿéš›ã«ã¯Stage H-Kã‚’å®Ÿè¡Œ |

**å¤‰æ›´å†…å®¹**:
- ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ–°å‘½åè¦å‰‡ã«å¤‰æ›´
- ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®docstringã€ã‚³ãƒ¡ãƒ³ãƒˆã€é–¢æ•°åã‚’æ›´æ–°
  - `reprocess_with_stageC()` â†’ `reprocess_with_stageh()`
  - "Stage Cå†å®Ÿè¡Œ" â†’ "Stage Hå†å®Ÿè¡Œ"

---

### 2. ã‚³ãƒ¼ãƒ‰å†…ã®å¤‰æ•°åãƒ»é–¢æ•°å‚ç…§ã®ä¿®æ­£ (3ãƒ•ã‚¡ã‚¤ãƒ«)

#### `process_queued_documents.py`

**å¤‰æ•°åã®ä¿®æ­£**:
| æ—§å¤‰æ•°å | æ–°å¤‰æ•°å | ç®‡æ‰€ |
|---------|---------|------|
| `stagea_result_for_stagec` | `stagei_result_for_stageh` | 519è¡Œç›® |
| `stagec_result` | `stageh_result` | 524è¡Œç›®ã€œ |
| `stagec_metadata` | `stageh_metadata` | 536è¡Œç›®ã€œ |
| `stagea_result` | `stagei_result` | 550è¡Œç›®ã€œ |

**ã‚³ãƒ¡ãƒ³ãƒˆã®ä¿®æ­£**:
- "Stage A: Geminiçµ±åˆãƒ»è¦ç´„" â†’ "Stage I: Geminiçµ±åˆãƒ»è¦ç´„"
- ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã® "[Stage A]" â†’ "[Stage I]"

**é‡è¦**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ å `stagea_classifier_model`, `stageb_vision_model`, `stagec_extractor_model` ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚**å¤‰æ›´ã—ã¦ã„ã¾ã›ã‚“**ã€‚

---

#### `H_streamlit/components/manual_text_correction.py`
#### `ui/components/manual_text_correction.py`

**ä¿®æ­£å†…å®¹**:
- docstringå†…: "Stage Aã®çµæœã‚’å«ã‚€" â†’ "Stage Içµ±åˆã®çµæœã‚’å«ã‚€"
- ã‚³ãƒ¡ãƒ³ãƒˆ: "# Stage Aã®æƒ…å ±ã‚’è¡¨ç¤º" â†’ "# Visionè§£æã®æƒ…å ±ã‚’è¡¨ç¤º"
- éæ¨å¥¨é–¢æ•°ã®è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã®importå‚ç…§ã‚’æ›´æ–°
  - `stageC_reprocessor.reprocess_with_stageC()` â†’ `stage_h_reprocessor.reprocess_with_stageh()`

---

### 3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°

#### `README.md`

**ä¿®æ­£å‰** (298-307è¡Œç›®):
```
â”œâ”€â”€ D_stage_a_classifier/             # Stage A: æ–‡æ›¸åˆ†é¡
â”œâ”€â”€ E_stage_b_vision/                 # Stage B: ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»OCR
â”œâ”€â”€ F_stage_c_extractor/              # Stage C: æ§‹é€ åŒ–æŠ½å‡º
```

**ä¿®æ­£å¾Œ**:
```
â”œâ”€â”€ G_unified_pipeline/               # çµ±åˆå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆStage E-Kï¼‰
â”‚   â”œâ”€â”€ stage_e_preprocessing.py    # Stage E: å‰å‡¦ç†
â”‚   â”œâ”€â”€ stage_f_visual.py           # Stage F: Visionè§£æ
â”‚   â”œâ”€â”€ stage_g_formatting.py       # Stage G: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ•´å½¢
â”‚   â”œâ”€â”€ stage_h_structuring.py      # Stage H: æ§‹é€ åŒ–
â”‚   â”œâ”€â”€ stage_i_synthesis.py        # Stage I: çµ±åˆãƒ»è¦ç´„
â”‚   â”œâ”€â”€ stage_j_chunking.py         # Stage J: ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°
â”‚   â”œâ”€â”€ stage_k_embedding.py        # Stage K: ãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿
â”‚   â””â”€â”€ config/                     # ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š
```

---

#### `.dockerignore`

**å‰Šé™¤ã—ãŸè¡Œ** (13-15è¡Œç›®):
```
D_stage_a_classifier/
E_stage_b_vision/
F_stage_c_extractor/
```

ç†ç”±: ã“ã‚Œã‚‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯æ—¢ã«å­˜åœ¨ã—ãªã„ãŸã‚ã€é™¤å¤–æŒ‡å®šã‚‚ä¸è¦

---

### 4. ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

**å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«**:
- `J_resources/scripts/py/update_imports.py`

**ç†ç”±**:
- ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€D_stage_a_classifierã€E_stage_b_visionã€F_stage_c_extractorã¸ã®importã‚’ç½®æ›ã™ã‚‹ãŸã‚ã®ã‚‚ã®
- ã“ã‚Œã‚‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯æ—¢ã«å‰Šé™¤æ¸ˆã¿ã®ãŸã‚ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚ä¸è¦

---

## ğŸ“‹ ä¿æŒã—ãŸé …ç›®ï¼ˆå¤‰æ›´ä¸è¦ã¨åˆ¤æ–­ï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ (3ãƒ•ã‚¡ã‚¤ãƒ«)

ä»¥ä¸‹ã®SQLãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€**ç¾è¡Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ**ã§ä½¿ç”¨ä¸­ã®ãŸã‚ä¿æŒ:
- `J_resources/sql/migration_b1_add_all_model_columns.sql`
- `J_resources/sql/add_missing_columns.sql`
- `J_resources/sql/step3_rename_and_create_view.sql`

**ç†ç”±**:
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚«ãƒ©ãƒ å `stageA_classifier_model`, `stageB_vision_model`, `stageC_extractor_model` ã¯ã€å®Ÿéš›ã®DBã‚¹ã‚­ãƒ¼ãƒã¨ã—ã¦å®šç€ã—ã¦ã„ã‚‹ãŸã‚å¤‰æ›´ã—ãªã„æ–¹é‡ã€‚

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–¢é€£ (8ãƒ•ã‚¡ã‚¤ãƒ«)

ä»¥ä¸‹ã¯**å±¥æ­´è¨˜éŒ²ãƒ»èª¬æ˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ã¨ã—ã¦ä¿æŒ:
- `æ•´ç†å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ.md` - Stage1/2ã®æ•´ç†è¨˜éŒ²
- `stage1_stage2_æ®‹éª¸åˆ†æ.md` - Stage1/2ã®åˆ†æè¨˜éŒ²
- `A_common/config/CLEANUP_ANALYSIS.md` - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†åˆ†æ
- `J_resources/docs/3TIER_ARCHITECTURE_GUIDE.md` - 3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰ï¼ˆDBã‚«ãƒ©ãƒ åã®èª¬æ˜ï¼‰
- `J_resources/docs/GAS_INTEGRATION_GUIDE.md` - GASé€£æºã‚¬ã‚¤ãƒ‰ï¼ˆDBã‚«ãƒ©ãƒ åã®èª¬æ˜ï¼‰
- `J_resources/docs/MIGRATION_COMPLETE.md` - ç§»è¡Œå®Œäº†è¨˜éŒ²
- `J_resources/docs/archive/PROJECT_EVALUATION_REPORT_20251212.md` - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ¸ˆã¿è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ
- `J_resources/docs/archive/PROGRESS_LOG_20251212.md` - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ¸ˆã¿é€²æ—ãƒ­ã‚°

### ç§»è¡Œå±¥æ­´ã‚³ãƒ¡ãƒ³ãƒˆ (2ãƒ•ã‚¡ã‚¤ãƒ«)

ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ç§»è¡Œå±¥æ­´ã¨ã—ã¦ä¿æŒ:
- `G_unified_pipeline/stage_i_synthesis.py:8` - "D_stage_a_classifier ã‹ã‚‰å®Œå…¨ç§»è¡Œ"
- `G_unified_pipeline/stage_h_structuring.py:9` - "F_stage_c_extractor ã‹ã‚‰å®Œå…¨ç§»è¡Œ"

---

## ğŸ” æ¢ç´¢çµæœã®è©³ç´°

### ç™ºè¦‹ã•ã‚ŒãŸæ®‹éª¸ã®ç·æ•°

- **ãƒ•ã‚¡ã‚¤ãƒ«åã«é–¢é€£**: 2ãƒ•ã‚¡ã‚¤ãƒ« (`stageC_reprocessor.py` x2)
- **ã‚³ãƒ¼ãƒ‰å†…å‚ç…§**: 17ãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…å‚ç…§**: 12ãƒ•ã‚¡ã‚¤ãƒ«
- **SQLãƒ•ã‚¡ã‚¤ãƒ«**: 3ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¿æŒï¼‰
- **å‰Šé™¤æ¸ˆã¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: D_stage_a_classifier, E_stage_b_vision, F_stage_c_extractorï¼ˆæ—¢ã«å‰Šé™¤æ¸ˆã¿ï¼‰

### æ¤œç´¢ã«ä½¿ç”¨ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³

- ãƒ•ã‚¡ã‚¤ãƒ«å: `*stage_a*`, `*stage_b*`, `*stage_c*`, `*stageC*`
- ã‚³ãƒ¼ãƒ‰å†…: `stage_a`, `stage_b`, `stage_c`, `Stage A`, `Stage B`, `Stage C`
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå: `D_stage_a`, `E_stage_b`, `F_stage_c`
- Importæ–‡: `from/import ... stage[abc]`

---

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ åã¯å¤‰æ›´ä¸å¯

ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ åã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã§å®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€**å¤‰æ›´ã—ã¦ã„ã¾ã›ã‚“**:
- `stageA_classifier_model` - åˆ†é¡ã«ä½¿ç”¨ã—ãŸAIãƒ¢ãƒ‡ãƒ«
- `stageB_vision_model` - Visionå‡¦ç†ã«ä½¿ç”¨ã—ãŸAIãƒ¢ãƒ‡ãƒ«
- `stageC_extractor_model` - æŠ½å‡ºã«ä½¿ç”¨ã—ãŸAIãƒ¢ãƒ‡ãƒ«

ã“ã‚Œã‚‰ã¯ã€ŒStage A/B/Cã€ã¨ã„ã†æ¦‚å¿µã§ã¯ãªãã€å˜ãªã‚‹ã‚«ãƒ©ãƒ åã¨ã—ã¦å®šç€ã—ã¦ã„ã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã§ã“ã‚Œã‚‰ã‚’å‚ç…§ã™ã‚‹ç®‡æ‰€ã¯**ä¿æŒ**ãŒé©åˆ‡ã§ã™ã€‚

---

## ğŸ“ˆ æ•´ç†åŠ¹æœ

### Before (æ•´ç†å‰)
- æ—§å‘½åè¦å‰‡ï¼ˆStage A/B/Cï¼‰ã¨æ–°å‘½åè¦å‰‡ï¼ˆStage E-Kï¼‰ãŒæ··åœ¨
- ãƒ•ã‚¡ã‚¤ãƒ«åã¨å®Ÿéš›ã®å‡¦ç†å†…å®¹ãŒä¸ä¸€è‡´ï¼ˆ`stageC_reprocessor.py`ãŒå®Ÿéš›ã¯Stage H-Kã‚’å®Ÿè¡Œï¼‰
- ã‚³ãƒ¼ãƒ‰å†…ã®å¤‰æ•°åãŒå¤ã„å‘½åè¦å‰‡ã®ã¾ã¾
- å­˜åœ¨ã—ãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®å‚ç…§ãŒæ®‹å­˜

### After (æ•´ç†å¾Œ)
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«åãŒå®Ÿéš›ã®å‡¦ç†å†…å®¹ã¨ä¸€è‡´
- âœ… ã‚³ãƒ¼ãƒ‰å†…ã®å¤‰æ•°åãƒ»ã‚³ãƒ¡ãƒ³ãƒˆãŒæ–°å‘½åè¦å‰‡ã§çµ±ä¸€
- âœ… READMEãŒç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚’æ­£ç¢ºã«åæ˜ 
- âœ… å­˜åœ¨ã—ãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®å‚ç…§ã‚’å‰Šé™¤
- âœ… ä¸è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‰Šé™¤
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ åã¯ä¿æŒï¼ˆäº’æ›æ€§ç¶­æŒï¼‰

---

## ğŸ¯ ä»Šå¾Œã®æ–¹é‡

### å‘½åè¦å‰‡ã®çµ±ä¸€

**ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹é€ **:
- **Stage E-K**: çµ±åˆå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆG_unified_pipelineï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ **: `stageA_*`, `stageB_*`, `stageC_*`ï¼ˆå¤‰æ›´ã—ãªã„ï¼‰

**ä»Šå¾Œã®é–‹ç™ºã§ã®æ³¨æ„ç‚¹**:
1. æ–°è¦ã‚³ãƒ¼ãƒ‰ã§ã¯å¿…ãš **Stage E-K** ã®å‘½åè¦å‰‡ã‚’ä½¿ç”¨
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ ã‚’å‚ç…§ã™ã‚‹éš›ã¯ã€æ—¢å­˜ã® `stageA_*`, `stageB_*`, `stageC_*` ã‚’ä½¿ç”¨
3. ã‚³ãƒ¡ãƒ³ãƒˆã‚„docstringã§ã¯ã€å®Ÿéš›ã®å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆStage H, Stage Iãªã©ï¼‰ã‚’æ˜è¨˜

---

## âœ… æ•´ç†å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] ãƒ•ã‚¡ã‚¤ãƒ«åã®å¤‰æ›´
- [x] é–¢æ•°åãƒ»å¤‰æ•°åã®ä¿®æ­£
- [x] ã‚³ãƒ¡ãƒ³ãƒˆãƒ»docstringã®æ›´æ–°
- [x] README.mdã®æ›´æ–°
- [x] .dockerignoreã®æ›´æ–°
- [x] ä¸è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‰Šé™¤
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿æŒç¢ºèª
- [x] å±¥æ­´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¿æŒç¢ºèª
- [x] æ•´ç†ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆ

---

## ğŸ“ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Stage1/2æ®‹éª¸åˆ†æ](./stage1_stage2_æ®‹éª¸åˆ†æ.md) - å‰å›ã®æ•´ç†åˆ†æ
- [æ•´ç†å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ](./æ•´ç†å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ.md) - Stage1/2ã®æ•´ç†å®Œäº†è¨˜éŒ²
- [G_unified_pipeline/README.md](./G_unified_pipeline/README.md) - çµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®èª¬æ˜

---

**æ•´ç†æ‹…å½“**: Claude Sonnet 4.5
**æ•´ç†å®Œäº†æ—¥**: 2025-12-19
