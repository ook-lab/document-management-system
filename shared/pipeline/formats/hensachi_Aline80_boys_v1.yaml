# =============================================================================
# FORMAT DEFINITION: hensachi_Aline80_boys_v1
# =============================================================================
# 対象: 合不合判定テスト Aライン80 偏差値一覧 男子
# 用途: 中学受験の偏差値表（四谷大塚系）
# 他社（サピックス、日能研等）との混同を避けるため厳格な検出条件を設定
# =============================================================================

format_id: hensachi_Aline80_boys_v1
version: "1.1"
priority: 200  # 他の汎用テーブルより高優先度
description: "合不合判定テスト Aライン80 偏差値一覧 男子"

# -----------------------------------------------------------------------------
# detect: テキストパターンによる判定ルール
# -----------------------------------------------------------------------------
# OCRによるトークン分割（「偏差」と「値」など）に対応するため正規表現を使用
# 四谷大塚特有の証拠の組み合わせを必須条件とする
# -----------------------------------------------------------------------------
detect:
  scope: top_left_right
  sample_rows: 15

  # 必須条件（AND）- すべて満たす必要あり
  must_all:
    - pattern: "偏\\s*差\\s*値"
      type: regex
    - pattern: "A\\s*ライン\\s*80"
      type: regex

  # いずれか条件（OR）- min_any_hits 以上満たす
  must_any:
    - pattern: "四\\s*谷\\s*大\\s*塚"
      type: regex
    - pattern: "合\\s*不\\s*合"
      type: regex
    - pattern: "判定\\s*テスト"
      type: regex
    - "男子"
    - "学校名"

  # 除外条件（NOT）- 1つでもヒットしたら除外
  must_not:
    - "女子"
    - "サピックス"
    - "SAPIX"
    - "日能研"
    - "首都圏模試"

  min_any_hits: 2

# -----------------------------------------------------------------------------
# fingerprint: 構造特徴による補助判定
# -----------------------------------------------------------------------------
# 偏差値軸（32〜70）の垂直分布を検証
# 横線がない特性（v_only）を利用
# -----------------------------------------------------------------------------
fingerprint:
  expected_cols: [3, 4, 5, 6]
  expected_rows_min: 10
  grid_nature: v_only
  has_merged_cells: false

  # 偏差値軸の検証条件
  deviation_axis:
    enabled: true
    range: [32, 70]
    min_unique_values: 20
    position: left_right_edge
    vertical_alignment: true

# -----------------------------------------------------------------------------
# schema: 意味抽出マッピング（決定論）
# -----------------------------------------------------------------------------
schema:
  column_strategy: axis_bins
  header_policy: none

  header:
    x_header: implicit
    y_header: left
    right_header_mode: auto
    implicit_labels:
      0: "学校名"
      1: "偏差値"
      2: "日程"
      3: "備考"

  columns:
    - col: 0
      role: name
      label: "学校名"
    - col: 1
      role: amount
      label: "偏差値"
    - col: 2
      role: date
      label: "日程"
    - col: 3
      role: other
      label: "備考"

# -----------------------------------------------------------------------------
# metadata: 管理情報
# -----------------------------------------------------------------------------
metadata:
  author: "system"
  created: "2026-02-03"
  updated: "2026-02-04"
  notes: |
    - 四谷大塚の合不合判定テスト偏差値表
    - 男子用（女子用は別フォーマット hensachi_Aline80_girls_v1）
    - 縦罫線のみの構造が特徴（grid_nature: v_only）
    - 偏差値軸（32〜70）が左右端に垂直に並ぶ
    - 他社（サピックス、日能研等）との混同を避けるため厳格な検出条件
