-- =============================================================================
-- Seed Data for Phase 2 RLS Testing
-- =============================================================================
-- テスト用ユーザーとデータを作成
-- User A: alice@example.com - 自分のデータを編集・削除できる
-- User B: bob@example.com   - User A のデータを編集・削除できない
-- =============================================================================

-- テスト用ユーザーのUUID（固定値で再現性を確保）
-- Supabase Auth では auth.users にユーザーが作成される
-- seed.sql では auth.users への直接挿入ができないため、
-- ここでは ID を定数として定義し、実際のユーザー作成は別途行う

-- User A: alice@example.com
-- UUID: 11111111-1111-1111-1111-111111111111

-- User B: bob@example.com
-- UUID: 22222222-2222-2222-2222-222222222222

-- =============================================================================
-- MASTER_Categories_expense (費目マスタ)
-- =============================================================================
INSERT INTO "MASTER_Categories_expense" (id, name)
VALUES
    ('a0000001-0000-0000-0000-000000000001', '食費'),
    ('a0000001-0000-0000-0000-000000000002', '日用品'),
    ('a0000001-0000-0000-0000-000000000003', '交通費')
ON CONFLICT (name) DO NOTHING;

-- =============================================================================
-- MASTER_Categories_purpose (名目マスタ)
-- =============================================================================
INSERT INTO "MASTER_Categories_purpose" (id, name, display_order)
VALUES
    ('b0000001-0000-0000-0000-000000000001', '日常', 1),
    ('b0000001-0000-0000-0000-000000000002', '特別', 2),
    ('b0000001-0000-0000-0000-000000000003', 'イベント', 3)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- Rawdata_FILE_AND_MAIL (User A のデータ)
-- =============================================================================
INSERT INTO "Rawdata_FILE_AND_MAIL" (
    id, source_id, file_name, workspace, doc_type,
    owner_id, review_status, created_at
)
VALUES
    -- User A のドキュメント
    (
        'doc-a001-0000-0000-0000-000000000001',
        'drive-a001',
        'alice_document_1.pdf',
        'personal',
        'school_newsletter',
        '11111111-1111-1111-1111-111111111111',
        'pending',
        NOW()
    ),
    (
        'doc-a002-0000-0000-0000-000000000002',
        'drive-a002',
        'alice_document_2.pdf',
        'personal',
        'school_newsletter',
        '11111111-1111-1111-1111-111111111111',
        'pending',
        NOW()
    ),
    -- User B のドキュメント
    (
        'doc-b001-0000-0000-0000-000000000001',
        'drive-b001',
        'bob_document_1.pdf',
        'personal',
        'school_newsletter',
        '22222222-2222-2222-2222-222222222222',
        'pending',
        NOW()
    )
ON CONFLICT DO NOTHING;

-- =============================================================================
-- 10_ix_search_index (検索インデックス)
-- =============================================================================
INSERT INTO "10_ix_search_index" (
    id, document_id, chunk_index, chunk_content, chunk_type, owner_id
)
VALUES
    -- User A のチャンク
    (
        'idx-a001-0000-0000-0000-000000000001',
        'doc-a001-0000-0000-0000-000000000001',
        0,
        'Alice のドキュメント1の内容です',
        'content',
        '11111111-1111-1111-1111-111111111111'
    ),
    -- User B のチャンク
    (
        'idx-b001-0000-0000-0000-000000000001',
        'doc-b001-0000-0000-0000-000000000001',
        0,
        'Bob のドキュメント1の内容です',
        'content',
        '22222222-2222-2222-2222-222222222222'
    )
ON CONFLICT DO NOTHING;

-- =============================================================================
-- Rawdata_RECEIPT_shops (User A のレシート)
-- =============================================================================
INSERT INTO "Rawdata_RECEIPT_shops" (
    id, transaction_date, shop_name, total_amount_check, owner_id
)
VALUES
    (
        'rcpt-a001-0000-0000-0000-000000000001',
        '2026-01-15',
        'スーパーマーケットA',
        1500,
        '11111111-1111-1111-1111-111111111111'
    ),
    (
        'rcpt-b001-0000-0000-0000-000000000001',
        '2026-01-15',
        'スーパーマーケットB',
        2000,
        '22222222-2222-2222-2222-222222222222'
    )
ON CONFLICT DO NOTHING;

-- =============================================================================
-- Rawdata_RECEIPT_items (レシート明細)
-- =============================================================================
INSERT INTO "Rawdata_RECEIPT_items" (
    id, receipt_id, line_number, product_name, quantity, std_amount
)
VALUES
    -- User A のレシート明細
    (
        'item-a001-0000-0000-0000-000000000001',
        'rcpt-a001-0000-0000-0000-000000000001',
        1,
        'りんご',
        3,
        300
    ),
    -- User B のレシート明細
    (
        'item-b001-0000-0000-0000-000000000001',
        'rcpt-b001-0000-0000-0000-000000000001',
        1,
        'バナナ',
        2,
        200
    )
ON CONFLICT DO NOTHING;

-- =============================================================================
-- MASTER_Rules_transaction_dict (辞書データ)
-- =============================================================================
INSERT INTO "MASTER_Rules_transaction_dict" (
    id, shop_name, product_name, category, created_by
)
VALUES
    -- User A が作成した辞書
    (
        'dict-a001-0000-0000-0000-000000000001',
        'スーパーマーケットA',
        'りんご',
        '食費',
        '11111111-1111-1111-1111-111111111111'
    ),
    -- User B が作成した辞書
    (
        'dict-b001-0000-0000-0000-000000000001',
        'スーパーマーケットB',
        'バナナ',
        '食費',
        '22222222-2222-2222-2222-222222222222'
    )
ON CONFLICT DO NOTHING;

-- =============================================================================
-- 99_lg_image_proc_log (処理ログ)
-- =============================================================================
INSERT INTO "99_lg_image_proc_log" (
    id, file_name, status, processed_at
)
VALUES
    (
        'log-0001-0000-0000-0000-000000000001',
        'test_receipt.jpg',
        'success',
        NOW()
    )
ON CONFLICT DO NOTHING;
